app-id: org.suckless.Surf
runtime: org.gnome.Platform
runtime-version: '3.34'
sdk: org.gnome.Sdk
command: /app/tabbedsurf 
finish-args:
  - --share=network
  - --share=ipc
  - --device=dri
  - --socket=x11
  - --socket=pulseaudio
  - --filesystem=home:ro
  - --filesystem=xdg-config:rw
  - --filesystem=xdg-cache:rw
  - --filesystem=xdg-data:rw
  - --talk-name=org.gtk.vfs.*
  - --filesystem=xdg-run/gvfsd
  - --filesystem=xdg-run/dconf
  - --filesystem=~/.config/dconf:ro
  - --talk-name=ca.desrt.dconf
  - --env=DCONF_USER_CONFIG_DIR=.config/dconf
modules:
  - name: xprop 
    sources:
      - type: git
        url: https://github.com/freedesktop/xprop.git 
        branch: master 
  - name: libxft 
    sources:
      - type: git
        url: https://github.com/freedesktop/libXft.git 
        branch: master 
  - name: libXinerama 
    sources:
      - type: git
        url: https://github.com/freedesktop/libXinerama.git 
        branch: master 
  
  - name: dmenu 
    no-autogen: true
    buildsystem: simple
    build-commands:
      - CC=gcc CFLAGS='-Wall -std=c99 -pthread' make && make install
    sources:
      - type: git
        url: https://git.suckless.org/dmenu
        branch: master
      - type: shell
        commands:
          - sed -i 's|#222222|#506090|' ./config.def.h
          - sed -i 's|#005577|#75afff|' ./config.def.h
          - sed -i 's|/usr/local|/app|' ./config.mk
  
  - name: tabbed 
    no-autogen: true
    buildsystem: simple
    build-commands:
      - CC=gcc CFLAGS='-Wall -std=c99 -pthread' make && make install
    sources:
      - type: git
        url: https://git.suckless.org/tabbed
        branch: master
      - type: shell
        commands:
          - sed -i 's|#222222|#506090|' ./config.def.h
          - sed -i 's|#555555|#75afff|' ./config.def.h
          - sed -i 's|/usr/local|/app|' ./Makefile
          - touch $FLATPAK_DEST/tabbedsurf
          - echo '#!/bin/bash' > $FLATPAK_DEST/tabbedsurf
          - echo 'exec tabbed surf -e "$@"' >> $FLATPAK_DEST/tabbedsurf
          - chmod +x $FLATPAK_DEST/tabbedsurf
  
  - name: surf
    no-autogen: true
    buildsystem: simple 
    build-commands:
      - CC=gcc CFLAGS='-Wall -std=c99 -pthread' make && make install
    sources:
      - type: archive
        url: http://dl.suckless.org/surf/surf-2.1.tar.gz
        sha256: 72e582920ba25a646203e93c2d2331d87f03037a28894d6c7e99af00ee043257
      - type: shell
        commands:
          - sed -i 's|/usr/local|/app|' ./config.mk
      - type: file
        url: http://surf.suckless.org/patches/web-search/surf-websearch-20190510-d068a38.diff
        sha256: 5fac3c3c8b5551b6d2e29323751b0dd41bd0febdabc65c3d7be6a5e91521d8df 
      - type: shell
        commands:
          - patch -p1 -F 20 < surf-websearch-20190510-d068a38.diff
      - type: file
        url: http://surf.suckless.org/patches/bookmarking/surf-bookmarks-20170722-723ff26.diff 
        sha256: 1220497722d9726db6a67b8dfcda90c61f26cf1f7a7724974efbdc84f32b6281 
      - type: shell
        commands:
          - patch -p1 -F 20 < surf-bookmarks-20170722-723ff26.diff 
